<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.projectecho.desktop.MainController">
    <top>
        <VBox>
            <MenuBar>
                <Menu text="Settings">
                    <Menu text="Polling Frequency">
                        <items>
                            <RadioMenuItem fx:id="freq15m" text="15 Minutes"/>
                            <RadioMenuItem fx:id="freq30m" text="30 Minutes (Default)"/>
                            <RadioMenuItem fx:id="freq1h" text="1 Hour"/>
                        </items>
                    </Menu>
                </Menu>
                <Menu text="Data">
                    <items>
                        <MenuItem onAction="#resetAllMentions" text="Reset All Mentions..."/>
                        <MenuItem onAction="#resetAllKeywords" text="Reset All Keywords..."/>
                    </items>
                </Menu>
            </MenuBar>
            <HBox spacing="10" style="-fx-padding: 10; -fx-background-color: #f0f0f0; -fx-border-color: #e0e0e0; -fx-border-width: 0 0 1 0;">
                <Button fx:id="mentionsButton" onAction="#showMentionsView" text="Mentions"/>
                <Button fx:id="analyticsButton" onAction="#showAnalyticsView" text="Analytics"/>
            </HBox>
        </VBox>
    </top>
    <center>
        <StackPane>
            <!-- Mentions View -->
            <BorderPane fx:id="mentionsView">
                <top>
                    <VBox spacing="10" style="-fx-padding: 10;">
                        <Label text="Add Keyword:"/>
                        <HBox spacing="10">
                            <TextField fx:id="keywordInput" onAction="#addKeyword" HBox.hgrow="ALWAYS"/>
                            <Button onAction="#addKeyword" text="Add"/>
                            <Button onAction="#checkNow" text="Check Now"/>
                        </HBox>
                    </VBox>
                </top>
                <center>
                    <VBox spacing="10" style="-fx-padding: 0 10 10 10;">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Filter by source:"/>
                            <ChoiceBox fx:id="sourceFilterChoiceBox"/>
                            <Label text="Filter by keyword:"/>
                            <ChoiceBox fx:id="keywordFilterChoiceBox"/>
                            <Label text="Filter by sentiment:"/>
                            <ChoiceBox fx:id="sentimentFilterChoiceBox"/>
                        </HBox>
                        <TitledPane fx:id="mentionsPane" text="Mentions" VBox.vgrow="ALWAYS">
                            <ListView fx:id="mentionListView" minHeight="150.0"/>
                        </TitledPane>
                    </VBox>
                </center>
                <bottom>
                    <VBox spacing="5" style="-fx-padding: 10;">
                        <Label fx:id="statusLabel" text="Waiting to start polling..."/>
                        <Label text="Keywords:"/>
                        <ListView fx:id="keywordListView">
                            <contextMenu>
                                <ContextMenu>
                                    <items>
                                        <MenuItem onAction="#deleteSelectedKeyword" text="Delete Keyword"/>
                                    </items>
                                </ContextMenu>
                            </contextMenu>
                        </ListView>
                    </VBox>
                </bottom>
            </BorderPane>
            
            <!-- Analytics View -->
            <ScrollPane fx:id="analyticsScrollPane" fitToWidth="true" visible="false">
                <!-- **FIX:** Set a minimum height on the content to force correct scrollbar calculation -->
                <VBox spacing="30.0" style="-fx-padding: 20;" minHeight="900.0">
                    <children>
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <children>
                                <Label text="Time Range:"><font><Font name="System Bold" size="14.0" /></font></Label>
                                <ChoiceBox fx:id="timeFilterChoiceBox" />
                            </children>
                            <VBox.margin><Insets bottom="5.0" /></VBox.margin>
                        </HBox>
                        <GridPane hgap="25" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                                <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                                <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                            </columnConstraints>
                            <children>
                                <VBox style="-fx-padding: 10; -fx-background-color: #f8f9fa; -fx-border-color: #dee2e6; -fx-border-radius: 5;">
                                    <Label text="Total Mentions" style="-fx-font-weight: bold;" />
                                    <Label fx:id="totalMentionsLabel" text="0"><font><Font size="24.0" /></font></Label>
                                </VBox>
                                <VBox style="-fx-padding: 10; -fx-background-color: #f8f9fa; -fx-border-color: #dee2e6; -fx-border-radius: 5;" GridPane.columnIndex="1">
                                    <Label text="Sentiment Ratio (Pos:Neg)" style="-fx-font-weight: bold;" />
                                    <Label fx:id="sentimentRatioLabel" text="0:0"><font><Font size="24.0" /></font></Label>
                                </VBox>
                                <VBox style="-fx-padding: 10; -fx-background-color: #f8f9fa; -fx-border-color: #dee2e6; -fx-border-radius: 5;" GridPane.columnIndex="2">
                                    <Label text="Most Active Source" style="-fx-font-weight: bold;" />
                                    <Label fx:id="mostActiveSourceLabel" text="N/A"><font><Font size="24.0" /></font></Label>
                                </VBox>
                            </children>
                        </GridPane>
                        <HBox spacing="25" VBox.vgrow="ALWAYS">
                            <children>
                                <PieChart fx:id="sentimentPieChart" title="Sentiment Breakdown" HBox.hgrow="ALWAYS" />
                                <BarChart fx:id="topSourcesBarChart" title="Top Sources" HBox.hgrow="ALWAYS">
                                    <xAxis><CategoryAxis side="BOTTOM" /></xAxis>
                                    <yAxis><NumberAxis side="LEFT" /></yAxis>
                                </BarChart>
                            </children>
                        </HBox>
                        <LineChart fx:id="mentionsOverTimeChart" title="Mentions Over Time" minHeight="350.0" VBox.vgrow="ALWAYS">
                            <xAxis><CategoryAxis side="BOTTOM" label="Date" /></xAxis>
                            <yAxis><NumberAxis side="LEFT" label="Number of Mentions" /></yAxis>
                        </LineChart>
                    </children>
                </VBox>
            </ScrollPane>
        </StackPane>
    </center>
</BorderPane>